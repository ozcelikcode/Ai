{% extends "admin/base.html" %}

{% block page_title %}Site Özelleştirme{% endblock %}
{% block page_description %}Sitenizin görünümünü ve footer ayarlarını yönetin{% endblock %}

{% block content %}
{% if request.query_params.get('success') %}
<div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-6">
    <i data-lucide="check-circle" class="w-5 h-5 inline mr-2"></i>
    Site özelleştirme ayarları başarıyla kaydedildi!
</div>
{% endif %}

{% if request.query_params.get('error') == 'invalid_file' %}
<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6">
    <i data-lucide="alert-circle" class="w-5 h-5 inline mr-2"></i>
    Sadece resim dosyaları yükleyebilirsiniz.
</div>
{% endif %}

<form method="POST" action="/admin/customize/save" enctype="multipart/form-data">
    <div class="space-y-8">
        
        <!-- Logo Özelleştirme -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-semibold text-brown-900 mb-4 flex items-center">
                <i data-lucide="image" class="w-5 h-5 mr-2"></i>
                Logo Özelleştirme
            </h3>
            
            <div class="space-y-6">
                <!-- Logo Type Selection -->
                <div>
                    <label class="block text-brown-700 font-medium mb-3">Logo Türü Seçin</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <label class="relative cursor-pointer">
                            <input type="radio" name="logo_type" value="text" 
                                   {% if not settings or not settings.logo_type or settings.logo_type == 'text' %}checked{% endif %}
                                   class="sr-only peer">
                            <div class="p-4 border-2 border-cream-300 rounded-xl peer-checked:border-brown-500 peer-checked:bg-brown-50 hover:bg-cream-50 transition-smooth text-center">
                                <i data-lucide="type" class="w-8 h-8 mx-auto mb-2 text-brown-600"></i>
                                <div class="font-medium text-brown-900">Sadece Metin</div>
                                <div class="text-sm text-brown-600">Sadece site başlığı</div>
                            </div>
                        </label>
                        
                        <label class="relative cursor-pointer">
                            <input type="radio" name="logo_type" value="image" 
                                   {% if settings and settings.logo_type == 'image' %}checked{% endif %}
                                   class="sr-only peer">
                            <div class="p-4 border-2 border-cream-300 rounded-xl peer-checked:border-brown-500 peer-checked:bg-brown-50 hover:bg-cream-50 transition-smooth text-center">
                                <i data-lucide="image" class="w-8 h-8 mx-auto mb-2 text-brown-600"></i>
                                <div class="font-medium text-brown-900">Sadece Resim</div>
                                <div class="text-sm text-brown-600">Logo resmi</div>
                            </div>
                        </label>
                        
                        <label class="relative cursor-pointer">
                            <input type="radio" name="logo_type" value="icon_text" 
                                   {% if settings and settings.logo_type == 'icon_text' %}checked{% endif %}
                                   class="sr-only peer">
                            <div class="p-4 border-2 border-cream-300 rounded-xl peer-checked:border-brown-500 peer-checked:bg-brown-50 hover:bg-cream-50 transition-smooth text-center">
                                <i data-lucide="layout" class="w-8 h-8 mx-auto mb-2 text-brown-600"></i>
                                <div class="font-medium text-brown-900">İkon + Metin</div>
                                <div class="text-sm text-brown-600">İkon ve başlık</div>
                            </div>
                        </label>
                        
                        <label class="relative cursor-pointer">
                            <input type="radio" name="logo_type" value="icon" 
                                   {% if settings and settings.logo_type == 'icon' %}checked{% endif %}
                                   class="sr-only peer">
                            <div class="p-4 border-2 border-cream-300 rounded-xl peer-checked:border-brown-500 peer-checked:bg-brown-50 hover:bg-cream-50 transition-smooth text-center">
                                <i data-lucide="star" class="w-8 h-8 mx-auto mb-2 text-brown-600"></i>
                                <div class="font-medium text-brown-900">Sadece İkon</div>
                                <div class="text-sm text-brown-600">Sadece ikon</div>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Icon Selection -->
                <div id="logo-icon-field" class="hidden">
                    <label class="block text-brown-700 font-medium mb-2">Logo İkon</label>
                    <div class="flex space-x-4">
                        <input type="text" name="logo_icon" 
                               value="{{ settings.logo_icon if settings else '' }}" 
                               placeholder="home, star, zap, heart, etc."
                               class="flex-1 px-3 py-3 border border-cream-300 rounded-lg focus:ring-2 focus:ring-brown-500 focus:border-transparent">
                        <div class="flex items-center px-4 py-3 bg-cream-50 rounded-lg border">
                            <span class="text-sm text-brown-600 mr-2">Önizleme:</span>
                            <i id="icon-preview" data-lucide="{{ settings.logo_icon if settings and settings.logo_icon else 'home' }}" class="w-6 h-6 text-brown-600"></i>
                        </div>
                    </div>
                    <p class="text-sm text-brown-600 mt-2">
                        <a href="https://lucide.dev/icons/" target="_blank" class="text-brown-700 hover:underline">
                            Lucide Icons kataloğundan ikon adı seçin →
                        </a>
                    </p>
                </div>
                
                <!-- Image Selection -->
                <div id="logo-image-field" class="hidden">
                    <label class="block text-brown-700 font-medium mb-2">Logo Resmi</label>
                    
                    <!-- Current logo preview -->
                    {% if settings and settings.site_logo %}
                    <div class="mb-4 p-4 bg-cream-50 rounded-lg">
                        <div class="flex items-center space-x-4">
                            <img src="{{ settings.site_logo }}" alt="Current Logo" class="w-16 h-16 object-contain">
                            <div>
                                <p class="font-medium text-brown-900">Mevcut Logo</p>
                                <p class="text-sm text-brown-600">{{ settings.site_logo }}</p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-brown-700 mb-2">Dosya Yükle</label>
                            <input type="file" name="logo_file" accept="image/*" 
                                   class="w-full px-3 py-3 border border-cream-300 rounded-lg focus:ring-2 focus:ring-brown-500 focus:border-transparent">
                        </div>
                        
                        <div class="text-center text-brown-500">veya</div>
                        
                        <div>
                            <label class="block text-sm font-medium text-brown-700 mb-2">Logo URL'i</label>
                            <input type="url" name="site_logo" 
                                   value="{% if settings and settings.site_logo %}{{ settings.site_logo }}{% endif %}" 
                                   placeholder="https://example.com/logo.png"
                                   class="w-full px-3 py-3 border border-cream-300 rounded-lg focus:ring-2 focus:ring-brown-500 focus:border-transparent">
                        </div>
                        
                        <div class="text-center text-brown-500">veya</div>
                        
                        <div>
                            <button type="button" onclick="openMediaGallery('logo')" 
                                    class="w-full px-4 py-3 bg-cream-100 text-brown-700 rounded-lg hover:bg-cream-200 transition-smooth flex items-center justify-center">
                                <i data-lucide="folder" class="w-5 h-5 mr-2"></i>
                                Medya Galerisinden Seç
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navbar Özelleştirme -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-semibold text-brown-900 mb-4 flex items-center">
                <i data-lucide="menu" class="w-5 h-5 mr-2"></i>
                Navbar Özelleştirme
            </h3>
            
            <div class="space-y-6">
                <!-- Navbar Menu Items Editor -->
                <div>
                    <label class="block text-brown-700 font-medium mb-4">Menü Öğeleri</label>
                    
                    <div id="navbar-items-gui" class="space-y-2 mb-4">
                        <!-- Default menu items -->
                        <div class="navbar-item bg-white border-2 border-cream-300 rounded-lg p-3 flex items-center gap-2" draggable="true">
                            <i data-lucide="grip-vertical" class="w-4 h-4 text-brown-500 cursor-move"></i>
                            <input type="text" placeholder="Metin" value="Ana Sayfa" class="flex-1 px-2 py-1 text-sm border rounded">
                            <input type="text" placeholder="Link" value="/" class="flex-1 px-2 py-1 text-sm border rounded">
                            <select class="px-2 py-1 text-sm border rounded">
                                <option value="">İkon Yok</option>
                                <option value="home" selected>home</option>
                                <option value="file-text">file-text</option>
                                <option value="folder">folder</option>
                                <option value="tag">tag</option>
                                <option value="user">user</option>
                                <option value="mail">mail</option>
                                <option value="info">info</option>
                            </select>
                            <button type="button" onclick="removeNavbarItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
                                <i data-lucide="x" class="w-3 h-3"></i>
                            </button>
                        </div>
                        
                        <div class="navbar-item bg-white border-2 border-cream-300 rounded-lg p-3 flex items-center gap-2" draggable="true">
                            <i data-lucide="grip-vertical" class="w-4 h-4 text-brown-500 cursor-move"></i>
                            <input type="text" placeholder="Metin" value="Kategoriler" class="flex-1 px-2 py-1 text-sm border rounded">
                            <input type="text" placeholder="Link" value="/categories" class="flex-1 px-2 py-1 text-sm border rounded">
                            <select class="px-2 py-1 text-sm border rounded">
                                <option value="">İkon Yok</option>
                                <option value="home">home</option>
                                <option value="file-text">file-text</option>
                                <option value="folder" selected>folder</option>
                                <option value="tag">tag</option>
                                <option value="user">user</option>
                                <option value="mail">mail</option>
                                <option value="info">info</option>
                            </select>
                            <button type="button" onclick="removeNavbarItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
                                <i data-lucide="x" class="w-3 h-3"></i>
                            </button>
                        </div>
                        
                        <div class="navbar-item bg-white border-2 border-cream-300 rounded-lg p-3 flex items-center gap-2" draggable="true">
                            <i data-lucide="grip-vertical" class="w-4 h-4 text-brown-500 cursor-move"></i>
                            <input type="text" placeholder="Metin" value="Hakkında" class="flex-1 px-2 py-1 text-sm border rounded">
                            <input type="text" placeholder="Link" value="/about" class="flex-1 px-2 py-1 text-sm border rounded">
                            <select class="px-2 py-1 text-sm border rounded">
                                <option value="">İkon Yok</option>
                                <option value="home">home</option>
                                <option value="file-text">file-text</option>
                                <option value="folder">folder</option>
                                <option value="tag">tag</option>
                                <option value="user">user</option>
                                <option value="mail">mail</option>
                                <option value="info" selected>info</option>
                            </select>
                            <button type="button" onclick="removeNavbarItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
                                <i data-lucide="x" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button type="button" onclick="addNavbarItem()" 
                            class="w-full px-4 py-2 bg-cream-100 text-brown-700 rounded-lg hover:bg-cream-200 transition-smooth flex items-center justify-center">
                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                        Yeni Menü Öğesi Ekle
                    </button>
                    
                    <!-- Hidden input for navbar configuration -->
                    <input type="hidden" name="navbar_config" id="navbar-config-data">
                    
                    <div class="mt-3 text-sm text-brown-600">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Sürükle-bırak ile sıralayın, menü öğelerini düzenleyin
                    </div>
                </div>
                
                <!-- Navbar Preview -->
                <div class="border-t border-cream-200 pt-4">
                    <label class="block text-brown-700 font-medium mb-2">Navbar Önizleme</label>
                    <div class="bg-brown-900 text-cream-100 p-4 rounded-lg">
                        <nav class="flex items-center justify-between">
                            <div class="flex items-center space-x-1">
                                <span class="text-xl font-bold mr-6">Logo</span>
                                <div id="navbar-preview" class="flex items-center space-x-1">
                                    <!-- Preview items will be generated here -->
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <button class="px-4 py-2 bg-cream-100 text-brown-900 rounded-lg text-sm">Giriş Yap</button>
                            </div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Özelleştirme -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-lg font-semibold text-brown-900 mb-4 flex items-center">
                <i data-lucide="layout" class="w-5 h-5 mr-2"></i>
                Footer Özelleştirme
            </h3>
            
            <div class="space-y-6">
                <!-- Copyright Text -->
                <div>
                    <label class="block text-brown-700 font-medium mb-2">Copyright Metni</label>
                    <input type="text" name="footer_copyright" 
                           value="{% if settings and settings.footer_copyright %}{{ settings.footer_copyright }}{% else %}© 2024 AI Blog. Tüm hakları saklıdır.{% endif %}"
                           placeholder="© 2024 Site Adı. Tüm hakları saklıdır."
                           class="w-full px-3 py-3 border border-cream-300 rounded-lg focus:ring-2 focus:ring-brown-500 focus:border-transparent">
                </div>
                
                <!-- Footer Columns GUI Editor -->
                <div>
                    <label class="block text-brown-700 font-medium mb-4">Footer Kolonları</label>
                    
                    <div id="footer-columns-gui" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <!-- Column 1 -->
                        <div class="footer-column-gui bg-white border-2 border-cream-300 rounded-lg p-4 cursor-move" data-column="1">
                            <div class="flex items-center justify-between mb-3">
                                <input type="text" name="column_1_title" value="Linkler" 
                                       class="font-medium text-brown-900 bg-transparent border-none outline-none flex-1">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="grip-vertical" class="w-4 h-4 text-brown-500 cursor-move"></i>
                                    <button type="button" onclick="addColumnItem(1)" class="text-brown-600 hover:text-brown-800">
                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="column-1-items" class="space-y-2">
                                <div class="flex items-center gap-2 column-item">
                                    <input type="text" placeholder="Metin" value="Ana Sayfa" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <input type="text" placeholder="Link" value="/" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <button type="button" onclick="removeColumnItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
                                        <i data-lucide="x" class="w-3 h-3"></i>
                                    </button>
                                </div>
                                <div class="flex items-center gap-2 column-item">
                                    <input type="text" placeholder="Metin" value="Kategoriler" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <input type="text" placeholder="Link" value="/categories" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <button type="button" onclick="removeColumnItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
                                        <i data-lucide="x" class="w-3 h-3"></i>
                                    </button>
                                </div>
                                <div class="flex items-center gap-2 column-item">
                                    <input type="text" placeholder="Metin" value="Hakkında" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <input type="text" placeholder="Link" value="/about" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <button type="button" onclick="removeColumnItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
                                        <i data-lucide="x" class="w-3 h-3"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Column 2 -->
                        <div class="footer-column-gui bg-white border-2 border-cream-300 rounded-lg p-4 cursor-move" data-column="2">
                            <div class="flex items-center justify-between mb-3">
                                <input type="text" name="column_2_title" value="İletişim" 
                                       class="font-medium text-brown-900 bg-transparent border-none outline-none flex-1">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="grip-vertical" class="w-4 h-4 text-brown-500 cursor-move"></i>
                                    <button type="button" onclick="addColumnItem(2)" class="text-brown-600 hover:text-brown-800">
                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="column-2-items" class="space-y-2">
                                <div class="flex items-center gap-2 column-item">
                                    <input type="text" placeholder="Metin" value="İletişim" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <input type="text" placeholder="Link" value="/contact" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <button type="button" onclick="removeColumnItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
                                        <i data-lucide="x" class="w-3 h-3"></i>
                                    </button>
                                </div>
                                <div class="flex items-center gap-2 column-item">
                                    <input type="text" placeholder="Metin" value="Gizlilik" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <input type="text" placeholder="Link" value="/privacy" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <button type="button" onclick="removeColumnItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
                                        <i data-lucide="x" class="w-3 h-3"></i>
                                    </button>
                                </div>
                                <div class="flex items-center gap-2 column-item">
                                    <input type="text" placeholder="Metin" value="Kullanım Şartları" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <input type="text" placeholder="Link" value="/terms" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <button type="button" onclick="removeColumnItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
                                        <i data-lucide="x" class="w-3 h-3"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Column 3 -->
                        <div class="footer-column-gui bg-white border-2 border-cream-300 rounded-lg p-4 cursor-move" data-column="3">
                            <div class="flex items-center justify-between mb-3">
                                <input type="text" name="column_3_title" value="Sosyal" 
                                       class="font-medium text-brown-900 bg-transparent border-none outline-none flex-1">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="grip-vertical" class="w-4 h-4 text-brown-500 cursor-move"></i>
                                    <button type="button" onclick="addSocialIcon(3)" class="text-brown-600 hover:text-brown-800">
                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="column-3-items" class="space-y-2">
                                <div class="flex items-center gap-2 social-item">
                                    <select class="px-2 py-1 text-sm border rounded">
                                        <option value="twitter">Twitter</option>
                                        <option value="facebook">Facebook</option>
                                        <option value="instagram">Instagram</option>
                                        <option value="linkedin">LinkedIn</option>
                                        <option value="youtube">YouTube</option>
                                    </select>
                                    <input type="text" placeholder="Link" value="#" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <button type="button" onclick="removeColumnItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
                                        <i data-lucide="x" class="w-3 h-3"></i>
                                    </button>
                                </div>
                                <div class="flex items-center gap-2 social-item">
                                    <select class="px-2 py-1 text-sm border rounded">
                                        <option value="twitter">Twitter</option>
                                        <option value="facebook" selected>Facebook</option>
                                        <option value="instagram">Instagram</option>
                                        <option value="linkedin">LinkedIn</option>
                                        <option value="youtube">YouTube</option>
                                    </select>
                                    <input type="text" placeholder="Link" value="#" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <button type="button" onclick="removeColumnItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
                                        <i data-lucide="x" class="w-3 h-3"></i>
                                    </button>
                                </div>
                                <div class="flex items-center gap-2 social-item">
                                    <select class="px-2 py-1 text-sm border rounded">
                                        <option value="twitter">Twitter</option>
                                        <option value="facebook">Facebook</option>
                                        <option value="instagram" selected>Instagram</option>
                                        <option value="linkedin">LinkedIn</option>
                                        <option value="youtube">YouTube</option>
                                    </select>
                                    <input type="text" placeholder="Link" value="#" class="flex-1 px-2 py-1 text-sm border rounded">
                                    <button type="button" onclick="removeColumnItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
                                        <i data-lucide="x" class="w-3 h-3"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hidden inputs for form submission -->
                    <input type="hidden" name="footer_column_1" id="footer-column-1-data">
                    <input type="hidden" name="footer_column_2" id="footer-column-2-data">
                    <input type="hidden" name="footer_column_3" id="footer-column-3-data">
                    <input type="hidden" name="footer_column_order" id="footer-column-order" value="1,2,3">
                    
                    <div class="mt-3 text-sm text-brown-600">
                        <i data-lucide="info" class="w-4 h-4 inline mr-1"></i>
                        Sürükle-bırak ile sıralayın, + ile öğe ekleyin
                    </div>
                </div>
                
                <!-- Footer Preview -->
                <div class="border-t border-cream-200 pt-4">
                    <label class="block text-brown-700 font-medium mb-2">Önizleme</label>
                    <div class="bg-brown-900 text-cream-100 p-6 rounded-lg">
                        <div id="footer-preview" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div id="preview-column-1"></div>
                                <div id="preview-column-2"></div>
                                <div id="preview-column-3"></div>
                            </div>
                            <div class="border-t border-cream-700 pt-4 text-center">
                                <p id="preview-copyright" class="text-cream-300"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kaydet Butonu -->
        <div class="flex justify-end space-x-4">
            <a href="/admin/settings" 
               class="px-6 py-3 border border-brown-300 text-brown-700 rounded-lg hover:bg-brown-50 transition-smooth">
                <i data-lucide="arrow-left" class="w-4 h-4 inline mr-2"></i>
                Genel Ayarlara Dön
            </a>
            <button type="submit" 
                    class="bg-brown-600 text-white px-6 py-3 rounded-lg hover:bg-brown-700 transition-smooth">
                <i data-lucide="save" class="w-4 h-4 inline mr-2"></i>
                Değişiklikleri Kaydet
            </button>
        </div>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
// Logo type selection handler
document.addEventListener('DOMContentLoaded', function() {
    const logoTypeRadios = document.querySelectorAll('input[name="logo_type"]');
    const logoIconField = document.getElementById('logo-icon-field');
    const logoImageField = document.getElementById('logo-image-field');
    const iconInput = document.querySelector('input[name="logo_icon"]');
    const iconPreview = document.getElementById('icon-preview');
    const footerTextarea = document.querySelector('textarea[name="footer_content"]');
    const footerPreview = document.getElementById('footer-preview');
    
    function toggleLogoFields() {
        const selectedType = document.querySelector('input[name="logo_type"]:checked').value;
        
        logoIconField.classList.add('hidden');
        logoImageField.classList.add('hidden');
        
        if (selectedType === 'icon' || selectedType === 'icon_text') {
            logoIconField.classList.remove('hidden');
        }
        
        if (selectedType === 'image') {
            logoImageField.classList.remove('hidden');
        }
    }
    
    logoTypeRadios.forEach(radio => {
        radio.addEventListener('change', toggleLogoFields);
    });
    
    // Icon preview update
    if (iconInput && iconPreview) {
        iconInput.addEventListener('input', function() {
            const iconName = this.value.trim() || 'home';
            iconPreview.setAttribute('data-lucide', iconName);
            lucide.createIcons();
        });
    }
    
    // Footer drag & drop and preview
    initializeFooterEditor();
    
    // Navbar drag & drop and preview
    initializeNavbarEditor();
    
    toggleLogoFields();
});

// Media gallery modal functions
let mediaGalleryModal = null;
let mediaGalleryTarget = null;

function openMediaGallery(target) {
    mediaGalleryTarget = target;
    
    if (!mediaGalleryModal) {
        createMediaGalleryModal();
    }
    
    loadMediaFiles();
    mediaGalleryModal.classList.remove('hidden');
}

function createMediaGalleryModal() {
    const modalHtml = `
        <div id="media-gallery-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
            <div class="bg-white rounded-xl p-6 max-w-4xl max-h-[80vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Medya Galerisi - Logo Seç</h3>
                    <button onclick="closeMediaGallery()" class="text-gray-500 hover:text-gray-700">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <div id="media-grid" class="grid grid-cols-4 gap-4">
                    <div class="text-center py-8">
                        <i data-lucide="loader" class="w-8 h-8 animate-spin mx-auto mb-2"></i>
                        <p>Medya dosyaları yükleniyor...</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    mediaGalleryModal = document.getElementById('media-gallery-modal');
}

function closeMediaGallery() {
    if (mediaGalleryModal) {
        mediaGalleryModal.classList.add('hidden');
    }
}

async function loadMediaFiles() {
    try {
        const response = await fetch('/admin/api/media');
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        const mediaGrid = document.getElementById('media-grid');
        
        if (!mediaGrid) {
            console.error('Media grid element not found');
            return;
        }
        
        mediaGrid.innerHTML = '';
        
        if (data.success && data.media && data.media.length > 0) {
            data.media.forEach(media => {
                if (media.mime_type && media.mime_type.startsWith('image/')) {
                    const mediaItem = document.createElement('div');
                    mediaItem.className = 'cursor-pointer border-2 border-transparent hover:border-brown-500 rounded-lg overflow-hidden transition-smooth';
                    mediaItem.onclick = () => selectMedia(media.file_path);
                    
                    mediaItem.innerHTML = `
                        <img src="${media.file_path}" alt="${media.alt_text || media.original_name || 'Media'}" 
                             class="w-full h-24 object-cover"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="w-full h-24 bg-gray-200 flex items-center justify-center" style="display:none;">
                            <i data-lucide="image-off" class="w-8 h-8 text-gray-500"></i>
                        </div>
                        <p class="p-2 text-xs text-gray-600 truncate">${media.original_name || 'Untitled'}</p>
                    `;
                    
                    mediaGrid.appendChild(mediaItem);
                }
            });
        } else {
            mediaGrid.innerHTML = '<div class="col-span-4 text-center py-8 text-brown-600"><i data-lucide="image-off" class="w-12 h-12 mx-auto mb-2"></i><p>Henüz medya dosyası yok</p></div>';
        }
        
        // Reinitialize Lucide icons
        if (typeof lucide !== 'undefined' && lucide.createIcons) {
            lucide.createIcons();
        }
    } catch (error) {
        console.error('Media yüklenirken hata:', error);
        const mediaGrid = document.getElementById('media-grid');
        if (mediaGrid) {
            mediaGrid.innerHTML = '<div class="col-span-4 text-center py-8 text-red-600"><i data-lucide="alert-circle" class="w-12 h-12 mx-auto mb-2"></i><p>Media dosyaları yüklenemedi</p></div>';
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
        }
    }
}

function selectMedia(filePath) {
    if (mediaGalleryTarget === 'logo') {
        document.querySelector('input[name="site_logo"]').value = filePath;
    }
    
    closeMediaGallery();
}

// Footer GUI Editor Functions
function initializeFooterEditor() {
    console.log('Initializing Footer Editor...');
    
    // Initialize drag and drop
    initializeFooterDragAndDrop();
    
    // Add listeners to all GUI inputs FIRST
    addFooterListeners();
    
    // Add event listeners for real-time preview
    const copyrightInput = document.querySelector('input[name="footer_copyright"]');
    if (copyrightInput) {
        copyrightInput.addEventListener('input', updateFooterPreview);
    }
    
    // Add listeners to column title inputs
    document.querySelectorAll('input[name^="column_"][name$="_title"]').forEach(input => {
        input.addEventListener('input', updateFooterPreview);
    });
    
    // Initialize preview
    updateFooterPreview();
    
    // Initialize form data generation before submit
    document.querySelector('form').addEventListener('submit', generateFooterData);
    
    console.log('Footer Editor initialized successfully');
}

function initializeFooterDragAndDrop() {
    const footerColumns = document.getElementById('footer-columns-gui');
    if (!footerColumns) return;
    
    let draggedElement = null;
    
    // Add drag event listeners to columns
    const columns = footerColumns.querySelectorAll('.footer-column-gui');
    columns.forEach(column => {
        column.draggable = true;
        
        column.addEventListener('dragstart', function(e) {
            draggedElement = this;
            this.style.opacity = '0.5';
            e.dataTransfer.effectAllowed = 'move';
        });
        
        column.addEventListener('dragend', function() {
            this.style.opacity = '1';
            draggedElement = null;
        });
        
        column.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        });
        
        column.addEventListener('dragenter', function(e) {
            e.preventDefault();
            this.style.borderColor = '#b45309';
        });
        
        column.addEventListener('dragleave', function() {
            this.style.borderColor = '#d1d5db';
        });
        
        column.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.borderColor = '#d1d5db';
            
            if (draggedElement && draggedElement !== this) {
                // Swap elements
                const parent = this.parentNode;
                const nextSibling = this.nextSibling;
                
                if (nextSibling) {
                    parent.insertBefore(draggedElement, nextSibling);
                } else {
                    parent.appendChild(draggedElement);
                }
                
                parent.insertBefore(this, draggedElement.nextSibling || null);
                
                // Update column order
                updateColumnOrder();
                
                // Update preview
                updateFooterPreview();
            }
        });
    });
}

function updateColumnOrder() {
    const columns = document.querySelectorAll('.footer-column-gui');
    const order = Array.from(columns).map(col => col.dataset.column);
    document.getElementById('footer-column-order').value = order.join(',');
}

function addFooterListeners() {
    console.log('Adding footer listeners...');
    
    // Add listeners to all inputs in GUI
    const elements = document.querySelectorAll('#footer-columns-gui input, #footer-columns-gui select');
    console.log(`Found ${elements.length} elements to add listeners to`);
    
    elements.forEach((input, index) => {
        input.addEventListener('input', function() {
            console.log(`Input ${index} changed:`, this.value);
            updateFooterPreview();
        });
        input.addEventListener('change', function() {
            console.log(`Change ${index} triggered:`, this.value);
            updateFooterPreview();
        });
    });
    
    console.log('Footer listeners added successfully');
}

function addColumnItem(columnNumber) {
    const container = document.getElementById(`column-${columnNumber}-items`);
    const newItem = document.createElement('div');
    newItem.className = 'flex items-center gap-2 column-item';
    newItem.innerHTML = `
        <input type="text" placeholder="Metin" class="flex-1 px-2 py-1 text-sm border rounded">
        <input type="text" placeholder="Link" class="flex-1 px-2 py-1 text-sm border rounded">
        <button type="button" onclick="removeColumnItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
            <i data-lucide="x" class="w-3 h-3"></i>
        </button>
    `;
    container.appendChild(newItem);
    
    // Add listeners to new inputs
    newItem.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', function() {
            console.log('New item input changed:', this.value);
            updateFooterPreview();
        });
        input.addEventListener('change', updateFooterPreview);
    });
    
    lucide.createIcons();
    updateFooterPreview();
}

function addSocialIcon(columnNumber) {
    const container = document.getElementById(`column-${columnNumber}-items`);
    const newItem = document.createElement('div');
    newItem.className = 'flex items-center gap-2 social-item';
    newItem.innerHTML = `
        <select class="px-2 py-1 text-sm border rounded">
            <option value="twitter">Twitter</option>
            <option value="facebook">Facebook</option>
            <option value="instagram">Instagram</option>
            <option value="linkedin">LinkedIn</option>
            <option value="youtube">YouTube</option>
        </select>
        <input type="text" placeholder="Link" class="flex-1 px-2 py-1 text-sm border rounded">
        <button type="button" onclick="removeColumnItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
            <i data-lucide="x" class="w-3 h-3"></i>
        </button>
    `;
    container.appendChild(newItem);
    
    // Add listeners to new inputs
    newItem.querySelectorAll('input, select').forEach(input => {
        input.addEventListener('input', function() {
            console.log('New social item changed:', this.value);
            updateFooterPreview();
        });
        input.addEventListener('change', function() {
            console.log('New social item changed (change event):', this.value);
            updateFooterPreview();
        });
    });
    
    lucide.createIcons();
    updateFooterPreview();
}

function removeColumnItem(button) {
    console.log('Removing item...');
    button.closest('.column-item, .social-item').remove();
    updateFooterPreview();
}

function generateFooterData() {
    // Generate HTML for each column based on GUI
    for (let i = 1; i <= 3; i++) {
        const container = document.getElementById(`column-${i}-items`);
        const title = document.querySelector(`input[name="column_${i}_title"]`).value;
        let html = '';
        
        if (i === 3) {
            // Social media column
            const socialItems = container.querySelectorAll('.social-item');
            if (socialItems.length > 0) {
                html = '<div class="flex space-x-3">';
                socialItems.forEach(item => {
                    const icon = item.querySelector('select').value;
                    const url = item.querySelector('input').value;
                    html += `<a href="${url}" class="text-cream-300 hover:text-white transition-smooth"><i data-lucide="${icon}" class="w-5 h-5"></i></a>`;
                });
                html += '</div>';
            }
        } else {
            // Regular link columns
            const linkItems = container.querySelectorAll('.column-item');
            if (linkItems.length > 0) {
                html = `<h4 class="font-semibold mb-4">${title}</h4><ul class="space-y-2">`;
                linkItems.forEach(item => {
                    const text = item.querySelectorAll('input')[0].value;
                    const url = item.querySelectorAll('input')[1].value;
                    html += `<li><a href="${url}" class="text-cream-300 hover:text-white transition-smooth">${text}</a></li>`;
                });
                html += '</ul>';
            }
        }
        
        document.getElementById(`footer-column-${i}-data`).value = html;
    }
}

function updateFooterPreview() {
    console.log('Updating footer preview...');
    
    const copyrightText = document.querySelector('input[name="footer_copyright"]').value || 
                         '© 2024 AI Blog. Tüm hakları saklıdır.';
    
    // Update copyright
    const copyrightElement = document.getElementById('preview-copyright');
    if (copyrightElement) {
        copyrightElement.innerHTML = copyrightText;
        console.log('Copyright updated:', copyrightText);
    }
    
    // Update columns based on GUI
    for (let i = 1; i <= 3; i++) {
        const container = document.getElementById(`column-${i}-items`);
        const title = document.querySelector(`input[name="column_${i}_title"]`).value;
        let html = '';
        
        if (i === 3) {
            // Social media column
            const socialItems = container.querySelectorAll('.social-item');
            if (socialItems.length > 0) {
                html = '<div class="flex space-x-3">';
                socialItems.forEach(item => {
                    const icon = item.querySelector('select').value;
                    const url = item.querySelector('input').value;
                    html += `<a href="${url}" class="text-cream-300 hover:text-white transition-smooth"><i data-lucide="${icon}" class="w-5 h-5"></i></a>`;
                });
                html += '</div>';
            }
        } else {
            // Regular link columns
            const linkItems = container.querySelectorAll('.column-item');
            if (linkItems.length > 0) {
                html = `<h4 class="font-semibold mb-4">${title}</h4><ul class="space-y-2">`;
                linkItems.forEach(item => {
                    const text = item.querySelectorAll('input')[0].value;
                    const url = item.querySelectorAll('input')[1].value;
                    html += `<li><a href="${url}" class="text-cream-300 hover:text-white transition-smooth">${text}</a></li>`;
                });
                html += '</ul>';
            }
        }
        
        const previewElement = document.getElementById(`preview-column-${i}`);
        if (previewElement) {
            previewElement.innerHTML = html;
            console.log(`Column ${i} preview updated:`, html);
        }
    }
    
    // Re-initialize Lucide icons in preview
    if (typeof lucide !== 'undefined' && lucide.createIcons) {
        lucide.createIcons();
    }
}

// Navbar Editor Functions
function initializeNavbarEditor() {
    console.log('Initializing Navbar Editor...');
    
    // Initialize drag and drop
    initializeNavbarDragAndDrop();
    
    // Add listeners to all navbar inputs
    addNavbarListeners();
    
    // Initialize preview
    updateNavbarPreview();
    
    // Initialize form data generation before submit
    const form = document.querySelector('form');
    const originalSubmit = form.onsubmit;
    form.addEventListener('submit', function(e) {
        generateNavbarData();
        if (originalSubmit) originalSubmit.call(this, e);
    });
    
    console.log('Navbar Editor initialized successfully');
}

function initializeNavbarDragAndDrop() {
    const navbarItems = document.getElementById('navbar-items-gui');
    if (!navbarItems) return;
    
    let draggedElement = null;
    
    // Add drag event listeners to items
    function addDragListeners(item) {
        item.addEventListener('dragstart', function(e) {
            draggedElement = this;
            this.style.opacity = '0.5';
            e.dataTransfer.effectAllowed = 'move';
        });
        
        item.addEventListener('dragend', function() {
            this.style.opacity = '1';
            draggedElement = null;
        });
        
        item.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        });
        
        item.addEventListener('dragenter', function(e) {
            e.preventDefault();
            this.style.borderColor = '#b45309';
        });
        
        item.addEventListener('dragleave', function() {
            this.style.borderColor = '#d1d5db';
        });
        
        item.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.borderColor = '#d1d5db';
            
            if (draggedElement && draggedElement !== this) {
                // Insert dragged element before this element
                this.parentNode.insertBefore(draggedElement, this);
                
                // Update preview
                updateNavbarPreview();
            }
        });
    }
    
    // Add listeners to existing items
    const items = navbarItems.querySelectorAll('.navbar-item');
    items.forEach(item => addDragListeners(item));
}

function addNavbarListeners() {
    console.log('Adding navbar listeners...');
    
    // Add listeners to all inputs in navbar GUI
    const elements = document.querySelectorAll('#navbar-items-gui input, #navbar-items-gui select');
    console.log(`Found ${elements.length} navbar elements to add listeners to`);
    
    elements.forEach((input, index) => {
        input.addEventListener('input', function() {
            console.log(`Navbar input ${index} changed:`, this.value);
            updateNavbarPreview();
        });
        input.addEventListener('change', function() {
            console.log(`Navbar change ${index} triggered:`, this.value);
            updateNavbarPreview();
        });
    });
    
    console.log('Navbar listeners added successfully');
}

function addNavbarItem() {
    const container = document.getElementById('navbar-items-gui');
    const newItem = document.createElement('div');
    newItem.className = 'navbar-item bg-white border-2 border-cream-300 rounded-lg p-3 flex items-center gap-2';
    newItem.draggable = true;
    newItem.innerHTML = `
        <i data-lucide="grip-vertical" class="w-4 h-4 text-brown-500 cursor-move"></i>
        <input type="text" placeholder="Metin" class="flex-1 px-2 py-1 text-sm border rounded">
        <input type="text" placeholder="Link" class="flex-1 px-2 py-1 text-sm border rounded">
        <select class="px-2 py-1 text-sm border rounded">
            <option value="">İkon Yok</option>
            <option value="home">home</option>
            <option value="file-text">file-text</option>
            <option value="folder">folder</option>
            <option value="tag">tag</option>
            <option value="user">user</option>
            <option value="mail">mail</option>
            <option value="info">info</option>
        </select>
        <button type="button" onclick="removeNavbarItem(this)" class="text-red-600 hover:text-red-800 px-2 py-1 border border-red-300 rounded hover:bg-red-50 flex-shrink-0 flex items-center justify-center">
            <i data-lucide="x" class="w-3 h-3"></i>
        </button>
    `;
    container.appendChild(newItem);
    
    // Add drag listeners to new item
    initializeNavbarDragAndDrop();
    
    // Add input listeners to new inputs
    newItem.querySelectorAll('input, select').forEach(input => {
        input.addEventListener('input', updateNavbarPreview);
        input.addEventListener('change', updateNavbarPreview);
    });
    
    lucide.createIcons();
    updateNavbarPreview();
}

function removeNavbarItem(button) {
    console.log('Removing navbar item...');
    button.closest('.navbar-item').remove();
    updateNavbarPreview();
}

function generateNavbarData() {
    const items = document.querySelectorAll('#navbar-items-gui .navbar-item');
    const navbarData = [];
    
    items.forEach(item => {
        const inputs = item.querySelectorAll('input');
        const select = item.querySelector('select');
        
        navbarData.push({
            text: inputs[0].value,
            link: inputs[1].value,
            icon: select.value
        });
    });
    
    document.getElementById('navbar-config-data').value = JSON.stringify(navbarData);
}

function updateNavbarPreview() {
    console.log('Updating navbar preview...');
    
    const previewContainer = document.getElementById('navbar-preview');
    if (!previewContainer) return;
    
    const items = document.querySelectorAll('#navbar-items-gui .navbar-item');
    let html = '';
    
    items.forEach(item => {
        const inputs = item.querySelectorAll('input');
        const select = item.querySelector('select');
        
        const text = inputs[0].value || 'Menu Item';
        const link = inputs[1].value || '#';
        const icon = select.value;
        
        html += `<a href="${link}" class="px-4 py-2 text-cream-100 hover:bg-brown-800 rounded-lg transition-smooth flex items-center space-x-2">`;
        if (icon) {
            html += `<i data-lucide="${icon}" class="w-4 h-4"></i>`;
        }
        html += `<span>${text}</span>`;
        html += `</a>`;
    });
    
    previewContainer.innerHTML = html;
    
    // Re-initialize Lucide icons in preview
    if (typeof lucide !== 'undefined' && lucide.createIcons) {
        lucide.createIcons();
    }
}
</script>
{% endblock %}