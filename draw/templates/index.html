<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SketchBoard</title>
    <!-- Tailwind via CDN for simplicity -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
  </head>
  <body class="min-h-screen bg-gradient-to-br from-indigo-100 via-indigo-50 to-fuchsia-100">
    <!-- Fixed hamburger menu (left) -->
    <aside class="fixed left-4 top-4 z-50">
      <button id="btnMenu" class="btn-animated floating-card rounded-xl bg-white/70 hover:bg-white shadow-md px-3 py-2 text-indigo-600 font-semibold">
        <i data-lucide="menu"></i>
      </button>
      <div id="sideMenu" class="hidden mt-3 w-60 floating-card rounded-xl bg-white/70 shadow-lg p-4 text-sm text-slate-700">
        <div class="font-bold text-slate-900 mb-2">Menu</div>
        <ul class="space-y-2">
          <li><a id="menuNew" href="#" class="hover:text-indigo-600 transition-colors">New Board</a></li>
          <li><a id="menuSaveImage" href="#" class="hover:text-indigo-600 transition-colors">Save as Image</a></li>
          <li><a id="menuSave" href="#" class="hover:text-indigo-600 transition-colors">Save</a></li>
          {% if user %}
          <li><a href="{{ url_for('my_drawings') }}" class="hover:text-indigo-600 transition-colors">My Drawings</a></li>
          <li><a href="{{ url_for('logout') }}" class="hover:text-indigo-600 transition-colors">Logout</a></li>
          {% else %}
          <li><a href="{{ url_for('login') }}" class="hover:text-indigo-600 transition-colors">Login</a></li>
          <li><a href="{{ url_for('register') }}" class="hover:text-indigo-600 transition-colors">Register</a></li>
          {% endif %}
        </ul>
      </div>
    </aside>

    <!-- Top centered title with tools inside -->
    <header class="fixed top-6 left-0 right-0 z-40 flex items-center justify-center">
      <div class="floating-card bg-white/80 rounded-2xl px-6 py-3 shadow-md border border-white/40 flex items-center gap-6">
        <h1 class="text-xl sm:text-2xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 to-fuchsia-500 tracking-tight">SketchBoard</h1>
        <div class="flex items-center gap-1">
          <button id="tool-pan" class="tool btn-animated group rounded-xl px-3 py-2 text-slate-700 hover:bg-indigo-50 hover:text-indigo-600" data-tool="pan" title="Pan (Space)">
            <i data-lucide="hand"></i>
          </button>
          <button id="tool-select" class="tool btn-animated group rounded-xl px-3 py-2 text-slate-700 hover:bg-indigo-50 hover:text-indigo-600" data-tool="select" title="Select (V)">
            <i data-lucide="mouse-pointer"></i>
          </button>
          <div id="penWidthWrapper" class="relative">
            <button id="tool-pencil" class="tool btn-animated group rounded-xl px-3 py-2 text-slate-700 hover:bg-indigo-50 hover:text-indigo-600" data-tool="pencil" title="Pencil (P)">
              <i data-lucide="pencil"></i>
            </button>
            <!-- Pen width popover (appears on right-click or double-click) -->
            <div id="penWidthPopover" class="hidden absolute top-full left-0 mt-2 z-[3000]">
              <div class="floating-card bg-white/80 rounded-xl shadow-lg border border-white/40 flex flex-col gap-2 p-2">
                <div id="penWidthGroup" class="flex items-center">
                <button type="button" class="px-2 py-2 rounded-lg text-slate-700 hover:bg-indigo-50 hover:text-indigo-600" data-penw="1.5" title="İnce">
                  <span class="inline-block rounded-full bg-slate-700" style="width:4px;height:4px"></span>
                </button>
                <button type="button" class="px-2 py-2 rounded-lg text-slate-700 hover:bg-indigo-50 hover:text-indigo-600" data-penw="3" title="Standart">
                  <span class="inline-block rounded-full bg-slate-700" style="width:8px;height:8px"></span>
                </button>
                <button type="button" class="px-2 py-2 rounded-lg text-slate-700 hover:bg-indigo-50 hover:text-indigo-600" data-penw="5" title="Kalın">
                  <span class="inline-block rounded-full bg-slate-700" style="width:12px;height:12px"></span>
                </button>
                <button type="button" class="px-2 py-2 rounded-lg text-slate-700 hover:bg-indigo-50 hover:text-indigo-600" data-penw="8" title="Çok Kalın">
                  <span class="inline-block rounded-full bg-slate-700" style="width:18px;height:18px"></span>
                </button>
                </div>
                <div id="penColorGroup" class="flex items-center gap-2">
                  <button type="button" class="w-6 h-6 rounded-full ring-2 ring-transparent" data-pencolor="#60a5fa" style="background-color:#60a5fa" title="Mavi"></button>
                  <button type="button" class="w-6 h-6 rounded-full ring-2 ring-transparent" data-pencolor="#a78bfa" style="background-color:#a78bfa" title="Mor"></button>
                  <button type="button" class="w-6 h-6 rounded-full ring-2 ring-transparent" data-pencolor="#f472b6" style="background-color:#f472b6" title="Pembe"></button>
                  <button type="button" class="w-6 h-6 rounded-full ring-2 ring-transparent" data-pencolor="#34d399" style="background-color:#34d399" title="Yeşil"></button>
                  <button type="button" class="w-6 h-6 rounded-full ring-2 ring-transparent" data-pencolor="#fbbf24" style="background-color:#fbbf24" title="Sarı"></button>
                  <button type="button" class="w-6 h-6 rounded-full ring-2 ring-transparent" data-pencolor="#fca5a5" style="background-color:#fca5a5" title="Kırmızı"></button>
                  <button type="button" class="w-6 h-6 rounded-full ring-2 ring-transparent" data-pencolor="#93c5fd" style="background-color:#93c5fd" title="Açık Mavi"></button>
                  <button type="button" class="w-6 h-6 rounded-full ring-2 ring-transparent" data-pencolor="#22d3ee" style="background-color:#22d3ee" title="Camgöbeceği"></button>
                </div>
              </div>
            </div>
          </div>
          <button id="tool-eraser" class="tool btn-animated group rounded-xl px-3 py-2 text-slate-700 hover:bg-indigo-50 hover:text-indigo-600" data-tool="eraser" title="Eraser (E)">
            <i data-lucide="eraser"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- Board wrapper (fixed) -->
    <main id="boardWrapper" class="z-10">
      <canvas id="board" class="w-full h-full"></canvas>

      <!-- Bottom-left controls: zoom, undo/redo -->
      <div class="fixed left-4 bottom-4 z-50 flex flex-col gap-2">
        <div class="floating-card bg-white/70 rounded-xl shadow-lg border border-white/40 flex items-center">
          <button id="zoomOut" class="btn-animated px-3 py-2 rounded-l-xl text-slate-700 hover:bg-indigo-50 hover:text-indigo-600" title="Zoom Out (-)">
            <i data-lucide="zoom-out"></i>
          </button>
          <div class="px-2 text-xs font-semibold text-slate-600" id="zoomLabel">100%</div>
          <button id="zoomIn" class="btn-animated px-3 py-2 rounded-r-xl text-slate-700 hover:bg-indigo-50 hover:text-indigo-600" title="Zoom In (+)">
            <i data-lucide="zoom-in"></i>
          </button>
        </div>
        <div class="floating-card bg-white/70 rounded-xl shadow-lg border border-white/40 flex items-center">
          <button id="undo" class="btn-animated px-3 py-2 rounded-l-xl text-slate-700 hover:bg-indigo-50 hover:text-indigo-600" title="Undo (Ctrl+Z)">
            <i data-lucide="undo-2"></i>
          </button>
          <button id="redo" class="btn-animated px-3 py-2 rounded-r-xl text-slate-700 hover:bg-indigo-50 hover:text-indigo-600" title="Redo (Ctrl+Y)">
            <i data-lucide="redo-2"></i>
          </button>
        </div>
      </div>
    </main>

    <!-- New Board confirm modal -->
    <div id="confirmNewModal" class="hidden fixed inset-0 z-[3000] flex items-center justify-center bg-black/40">
      <div class="floating-card bg-white rounded-2xl shadow-2xl border border-white/50 p-5 max-w-md w-[90%]">
        <div class="text-lg font-bold text-slate-800 mb-2">Start a new board?</div>
        <p class="text-slate-600 mb-4">Your current sketch has unsaved changes. If you continue, they will be lost. Would you like to proceed?</p>
        <div class="flex items-center gap-3 justify-end">
          <button id="confirmNewCancel" class="px-3 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-700">Cancel</button>
          <button id="confirmNewOk" class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white">Yes, start new</button>
        </div>
      </div>
    </div>

    <!-- Save link modal -->
    <div id="saveLinkModal" class="hidden fixed inset-0 z-[3000] flex items-center justify-center bg-black/40">
      <div class="floating-card bg-white rounded-2xl shadow-2xl border border-white/50 p-5 max-w-lg w-[92%]">
        <div class="text-lg font-bold text-slate-800 mb-2">Your board link</div>
        <p class="text-slate-600 mb-3">Use this link to open your board later. Save it or share it.</p>
        <div class="flex items-center gap-2 mb-4">
          <input id="saveLinkInput" type="text" readonly class="flex-1 px-3 py-2 rounded-lg border border-slate-200 bg-slate-50 text-slate-700" />
          <button id="btnCopyLink" class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white">Copy</button>
        </div>
        <div class="flex items-center justify-end">
          <button id="btnCloseSaveLink" class="px-3 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-700">Close</button>
        </div>
      </div>
    </div>

    <script>
      window.BOARD_DATA = {{ board_data|safe if board_data else 'null' }};
    </script>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
  </body>
  </html>


